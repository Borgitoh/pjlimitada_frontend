<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Page Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Meus Pedidos</h1>
      <p class="text-gray-600">Acompanhe seus pedidos finalizados e histórico de compras</p>
    </div>

    <!-- Search Form -->
    <div *ngIf="!showOrders" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6 max-w-md mx-auto">
      <div class="text-center mb-4">
        <svg class="mx-auto h-12 w-12 text-pj-cyan mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">Consultar Pedidos</h3>
        <p class="text-sm text-gray-600">Digite seu e-mail para ver seus pedidos</p>
      </div>
      
      <div class="space-y-4">
        <div>
          <label for="customerEmail" class="block text-sm font-medium text-gray-700 mb-2">
            Seu E-mail
          </label>
          <input
            id="customerEmail"
            type="email"
            [(ngModel)]="customerEmail"
            (keyup.enter)="searchOrders()"
            placeholder="seu@email.com"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pj-cyan focus:border-transparent">
        </div>
        
        <button
          (click)="searchOrders()"
          [disabled]="loading || !customerEmail.trim()"
          class="w-full px-6 py-3 bg-pj-cyan text-white rounded-lg hover:bg-pj-cyan-hover disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          <span *ngIf="!loading">Consultar Pedidos</span>
          <span *ngIf="loading" class="flex items-center justify-center">
            <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Consultando...
          </span>
        </button>
      </div>
    </div>

    <!-- Orders List -->
    <div *ngIf="showOrders" class="space-y-6">
      <!-- Back to Search -->
      <div class="flex items-center justify-between">
        <button
          (click)="showOrders = false; orders = []; customerEmail = ''"
          class="flex items-center px-4 py-2 text-pj-cyan hover:bg-pj-cyan hover:text-white border border-pj-cyan rounded-lg transition-colors">
          <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Nova Consulta
        </button>
        <div class="text-sm text-gray-600">
          Encontrados {{orders.length}} pedido(s) para <strong>{{customerEmail}}</strong>
        </div>
      </div>

      <!-- Orders Cards -->
      <div *ngIf="orders.length > 0" class="grid grid-cols-1 gap-6">
        <div *ngFor="let order of orders" class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
          <!-- Order Header -->
          <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
              <div>
                <h3 class="text-lg font-semibold text-gray-900">Pedido #{{order.id}}</h3>
                <p class="text-sm text-gray-600">Realizado em {{order.createdAt | date:'dd/MM/yyyy às HH:mm'}}</p>
              </div>
              <div class="mt-2 sm:mt-0 flex items-center space-x-3">
                <span [class]="'inline-flex px-3 py-1 rounded-full text-sm font-medium ' + getStatusColor(order.status)">
                  {{getStatusLabel(order.status)}}
                </span>
                <span class="text-lg font-bold text-pj-cyan">KZ {{order.total | number:'1.2-2'}}</span>
              </div>
            </div>
          </div>
          
          <!-- Order Content -->
          <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Order Items -->
              <div>
                <h4 class="font-medium text-gray-900 mb-3">Itens do Pedido</h4>
                <div class="space-y-3">
                  <div *ngFor="let item of order.items" class="flex items-center space-x-3 border-b border-gray-100 pb-3 last:border-b-0">
                    <img [src]="item.imagem" [alt]="item.nome" class="h-12 w-12 object-cover rounded-lg bg-gray-100">
                    <div class="flex-1 min-w-0">
                      <p class="text-sm font-medium text-gray-900 truncate">{{item.nome}}</p>
                      <p class="text-xs text-gray-500">{{item.marca}} • Qtd: {{item.quantidade}}</p>
                    </div>
                    <p class="text-sm font-semibold text-gray-900">KZ {{(item.preco * item.quantidade) | number:'1.2-2'}}</p>
                  </div>
                </div>
              </div>
              
              <!-- Order Info -->
              <div class="space-y-4">
                <!-- Shipping Address -->
                <div>
                  <h4 class="font-medium text-gray-900 mb-2">Endereço de Entrega</h4>
                  <div class="text-sm text-gray-600 space-y-1">
                    <p>{{order.shippingAddress.endereco}}, {{order.shippingAddress.numero}}</p>
                    <p *ngIf="order.shippingAddress.complemento">{{order.shippingAddress.complemento}}</p>
                    <p>{{order.shippingAddress.bairro}}</p>
                    <p>{{order.shippingAddress.cidade}} - {{order.shippingAddress.estado}}</p>
                    <p>CEP: {{order.shippingAddress.cep}}</p>
                  </div>
                </div>
                
                <!-- Payment & Delivery Info -->
                <div>
                  <h4 class="font-medium text-gray-900 mb-2">Informações Adicionais</h4>
                  <div class="text-sm text-gray-600 space-y-1">
                    <p><strong>Pagamento:</strong> {{getPaymentMethodLabel(order.paymentMethod)}}</p>
                    <p *ngIf="order.estimatedDelivery"><strong>Entrega estimada:</strong> {{order.estimatedDelivery | date:'dd/MM/yyyy'}}</p>
                    <div *ngIf="order.trackingCode" class="flex items-center space-x-2">
                      <span><strong>Código de rastreio:</strong></span>
                      <code class="bg-gray-100 px-2 py-1 rounded text-xs">{{order.trackingCode}}</code>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 mt-6 pt-4 border-t border-gray-200">
              <button
                (click)="trackOrder(order.id)"
                class="flex-1 px-4 py-2 bg-pj-cyan text-white rounded-lg hover:bg-pj-cyan-hover transition-colors">
                <svg class="h-4 w-4 mr-2 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                Rastrear Pedido
              </button>
              <button
                (click)="viewOrderDetails(order)"
                class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                <svg class="h-4 w-4 mr-2 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                Ver Detalhes
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="orders.length === 0" class="text-center py-12">
        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum pedido encontrado</h3>
        <p class="text-gray-600">Não foram encontrados pedidos para este e-mail.</p>
        <button
          routerLink="/pecas"
          class="mt-4 px-6 py-2 bg-pj-cyan text-white rounded-lg hover:bg-pj-cyan-hover transition-colors">
          Fazer Primeira Compra
        </button>
      </div>
    </div>

    <!-- Info Card -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mt-8">
      <div class="flex">
        <svg class="h-5 w-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <div>
          <h3 class="text-sm font-medium text-blue-800 mb-2">Informações Importantes</h3>
          <ul class="text-sm text-blue-700 space-y-1">
            <li>• Para rastreamento detalhado, use o código de rastreio nos Correios de Angola</li>
            <li>• Em caso de dúvidas, entre em contato pelo WhatsApp: +244 923 456 789</li>
            <li>• Pedidos cancelados ou com problemas aparecerão com status específico</li>
            <li>• O prazo de entrega pode variar conforme a localização</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
